<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zxh.ssm.module.analyzeDisease.mapper.AnalyzeMapper">

    <select id="selectDisease" resultType="String">
        SELECT DISTINCT(diseaseName) FROM patient_cases_information
	WHERE diseaseName NOT LIKE '%未分型%'
    </select>

    <resultMap id="analyzeBySexMap" type="com.zxh.ssm.module.analyzeDisease.pojo.SexAnalyzeRe">
        <result column="dataYear" property="year"/>
        <result column="disease" property="disease"/>
        <result column="sex" property="sex"/>
        <result column="num" property="patientNum"/>
    </resultMap>

    <select id="analyzeBySex" parameterType="String"
            resultMap="analyzeBySexMap">
        SELECT p.`year` AS dataYear,pci.diseaseName AS disease,p.sex AS sex,COUNT(p.sex) AS num FROM patient_information
        p
        JOIN patient_cases_information pci
        ON (p.`year` = pci.`year` AND p.cardID = pci.cardID)
        <where>
            AND pci.diseaseName NOT LIKE '疟疾（未分型）'
            <if test="'default'!=_parameter and ''!=_parameter">
                AND p.address LIKE '%${_parameter}%'
            </if>
        </where>
        GROUP BY p.sex , pci.diseaseName , pci.`year`
        ORDER BY pci.`year`,pci.diseaseName,p.sex;
    </select>


    <resultMap id="analyzeByCareerMap" type="com.zxh.ssm.module.analyzeDisease.pojo.CareerAnalyzeRe">
        <result column="year" property="year"/>
        <result column="diseaseName" property="disease"/>
        <result column="career" property="career"/>
        <result column="patientNum" property="patientNum"/>
    </resultMap>

    <select id="analyzeByCareer" parameterType="String"
            resultMap="analyzeByCareerMap">
        SELECT p.`year` AS `year`,pci.diseaseName AS diseaseName,p.career AS career,COUNT(p.career) AS patientNum
        FROM patient_information p JOIN patient_cases_information pci
        ON p.`year` = pci.`year` AND p.cardID = pci.cardID
        <where>
            AND pci.diseaseName NOT LIKE '疟疾（未分型）'
            AND p.career NOT LIKE '不详'
            <if test="'default'!=_parameter and ''!=_parameter">
                AND p.address LIKE '%${_parameter}%'
            </if>
        </where>
        GROUP BY p.career,pci.`year`,pci.diseaseName
        ORDER BY p.`year`,pci.diseaseName,p.career
    </select>

    <select id="analyzeByAgeGroup" parameterType="com.zxh.ssm.module.analyzeDisease.pojo.AnalyzeVo"
            resultType="int">
        SELECT COUNT((pi.`year`-YEAR(pi.birthday)+1)) FROM patient_information pi,patient_cases_information pci
        <where>
            AND pi.cardID = pci.cardID
            AND pi.`year` = pci.`year`
            <if test="province != null and province != ''">
                AND ( pi.address LIKE '${province}%')
            </if>
            <if test="virtualAgeUpLimit!=null and virtualAgeDownLimit!=null ">
                AND ((pi.`year`-YEAR(pi.birthday)+1) BETWEEN #{virtualAgeDownLimit} AND #{virtualAgeUpLimit})
            </if>
            <if test="0!=beginYear and 0!=endYear">
                AND (pi.`year` BETWEEN #{beginYear} AND #{endYear})
            </if>
            <if test="null!=diseaseName and ''!=diseaseName">
                AND pci.diseaseName LIKE '${diseaseName}'
            </if>
        </where>
    </select>

    <!--12.5-->
    <!--SELECT pi.sex AS sex,COUNT(pi.sex) AS patientNum-->
    <!--FROM patient_information pi ,patient_cases_information pci-->
    <!--<where>-->
    <!--AND pi.cardID = pci.cardID-->
    <!--AND pi.`year` = pci.`year`-->
    <!--<if test="0!=beginYear and 0!=endYear">-->
    <!--AND (pi.`year` BETWEEN #{beginYear} AND #{endYear})-->
    <!--</if>-->
    <!--<if test="province != null and province != ''">-->
    <!--AND ( pi.address LIKE '${province}%')-->
    <!--</if>-->
    <!--<if test="null!=diseaseName and ''!=diseaseName">-->
    <!--AND pci.diseaseName LIKE '${diseaseName}'-->
    <!--</if>-->
    <!--</where>-->
    <!--GROUP BY sex;-->

    <!--SELECT pi.career AS careerCategory,COUNT(pi.career) AS patientNum-->
    <!--FROM patient_information pi,patient_cases_information pci-->
    <!--<where>-->
    <!--AND pi.`year` = pci.`year` AND pi.cardID = pci.cardID-->
    <!--AND pi.career NOT IN ('不详','')-->
    <!--<if test="null!=province and ''!=province">-->
    <!--AND pi.address LIKE '%${province}%'-->
    <!--</if>-->
    <!--<if test="0!=beginYear and 0!=endYear">-->
    <!--AND pi.`year` BETWEEN #{beginYear} AND #{endYear}-->
    <!--</if>-->
    <!--<if test="null!=diseaseName and ''!=diseaseName ">-->
    <!--AND pci.diseaseName LIKE '${diseaseName}'-->
    <!--</if>-->
    <!--</where>-->
    <!--GROUP BY pi.career,pci.diseaseName-->
</mapper>

