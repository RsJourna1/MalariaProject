<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zxh.ssm.module.analyzeDisease.mapper.AnalyzeMapper">

    <select id="selectDisease" resultType="String">
        SELECT DISTINCT(diseaseName) FROM patient_cases_information
	WHERE diseaseName NOT LIKE '%未分型%'
    </select>
    <resultMap id="analyzeByCareerMap" type="com.zxh.ssm.module.analyzeDisease.pojo.CareerAnalyzeRe">
        <result column="careerCategory" property="careerCategory"/>
        <result column="patientNum" property="patientNum"/>
    </resultMap>

    <select id="analyzeByCareer" parameterType="com.zxh.ssm.module.analyzeDisease.pojo.AnalyzeVo"
            resultMap="analyzeByCareerMap">
        SELECT pi.career AS careerCategory,COUNT(pi.career) AS patientNum
        FROM patient_information pi,patient_cases_information pci
        <where>
            AND pi.`year` = pci.`year` AND pi.cardID = pci.cardID
            AND pi.career NOT IN ('不详','')
            <if test="null!=province and ''!=province">
                AND pi.address LIKE '%${province}%'
            </if>
            <if test="0!=beginYear and 0!=endYear">
                AND pi.`year` BETWEEN #{beginYear} AND #{endYear}
            </if>
            <if test="null!=diseaseName and ''!=diseaseName ">
                AND pci.diseaseName LIKE '${diseaseName}'
            </if>
        </where>
        GROUP BY pi.career,pci.diseaseName
    </select>


    <resultMap id="analyzeBySexMap" type="com.zxh.ssm.module.analyzeDisease.pojo.SexAnalyzeRe">
        <result column="sex" property="sex"/>
        <result column="patientNum" property="patientNum"/>
    </resultMap>

    <select id="analyzeBySex" parameterType="com.zxh.ssm.module.analyzeDisease.pojo.AnalyzeVo"
            resultMap="analyzeBySexMap">
        SELECT pi.sex AS sex,COUNT(pi.sex) AS patientNum
        FROM patient_information pi ,patient_cases_information pci
        <where>
            AND pi.cardID = pci.cardID
            AND pi.`year` = pci.`year`
            <if test="0!=beginYear and 0!=endYear">
                AND (pi.`year` BETWEEN #{beginYear} AND #{endYear})
            </if>
            <if test="province != null and province != ''">
                AND ( pi.address LIKE '${province}%')
            </if>
            <if test="null!=diseaseName and ''!=diseaseName">
                AND pci.diseaseName LIKE '${diseaseName}'
            </if>
        </where>
        GROUP BY sex;
    </select>


    <select id="analyzeByAgeGroup" parameterType="com.zxh.ssm.module.analyzeDisease.pojo.AnalyzeVo"
            resultType="int">
        SELECT COUNT((pi.`year`-YEAR(pi.birthday)+1)) FROM patient_information pi,patient_cases_information pci
        <where>
            AND pi.cardID = pci.cardID
            AND pi.`year` = pci.`year`
            <if test="province != null and province != ''">
                AND ( pi.address LIKE '${province}%')
            </if>
            <if test="virtualAgeUpLimit!=null and virtualAgeDownLimit!=null ">
                AND ((pi.`year`-YEAR(pi.birthday)+1) BETWEEN #{virtualAgeDownLimit} AND #{virtualAgeUpLimit})
            </if>
            <if test="0!=beginYear and 0!=endYear">
                AND (pi.`year` BETWEEN #{beginYear} AND #{endYear})
            </if>
            <if test="null!=diseaseName and ''!=diseaseName">
                AND pci.diseaseName LIKE '${diseaseName}'
            </if>
        </where>
    </select>

</mapper>